<!DOCTYPE html>
<html>
    <head>
        <title>snd.js - Basics - BufferSource</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width">
        
        <script src="../../../snd.js"></script>
        <script>
            /*
             * snd.util.createBufferSourcesメソッドに渡すデータです。
             * {音を識別するID : "URL"}
             * 同じURLを使用する音源は同じデータを自動で共有します。(同じデータは一度しかロードされません。)
             */
            DATA_SET = {
                "switch1":"./se_maoudamashii_onepoint26.wav",
                "switch2":"./se_maoudamashii_onepoint26.wav",
                "switch3":"./se_maoudamashii_onepoint26.wav"
            };
            
            /* 
             * ボタンクリック時に呼び出されるメソッドを定義だけしておきます。
             * データの読込みが完了した時に呼び出されるコールバックメソッドで、メソッドの内容を入れ替えます。
             */
            switch1push = function() {};
            switch2push = function() {};
            switch3push = function() {};
            
            window.onload = function() {
                snd.init();
                snd.util.createBufferSources(DATA_SET, main);
            };
            
            main = function(sourceSet) {
                // データのロードが完了し、音源が準備されたときに呼ばれるメソッドです。
                // 
                // 必要ならエフェクトの設定などを行い、snd.MASTER.connectAudioUnitメソッドで出力へ接続します。
                for (var id in sourceSet) {
                    snd.MASTER.connectAudioUnit(id, sourceSet[id]);
                }
                
                // ボタンクリック時に呼ばれるメソッドの内容を書き換えます。
                switch1push = function() {
                    sourceSet["switch1"].start();
                };
                
                switch2push = function() {
                    sourceSet["switch2"].start();
                };
                
                switch3push = function() {
                    sourceSet["switch3"].start();
                };
            };
            
        </script>
    </head>
    <body>
        <div>
            <h3>BufferSourceのサンプル</h3>
            あらかじめwavファイルを読込んでおき、ボタンをクリックした時にそのデータを鳴らすサンプルです。<br/>
            snd.util.createBufferSourcesメソッドを使用して、BufferSourceクラスのオブジェクトを作ります。<br/>
            snd.util.createBufferSourcesメソッドには、<b>音源を識別するIDとデータを取得するURLをまとめた連想配列</b>と<b>読込み完了時に呼び出されるコールバック関数</b>を渡します。<br/>
            具体的な使用方法はソースを参照してください。<br/>
            <button onclick='switch1push()'>switch1</button><br/>
            <button onclick='switch2push()'>switch2</button><br/>
            <button onclick='switch3push()'>switch3</button><br/>
            <hr/>
        </div>
    </body>
</html>
