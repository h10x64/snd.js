/**
 * snd.js - The Sound Library for JavaScript with WebAudioAPI - v.1.0 beta
 * 
 * The MIT License (MIT)
 * copyright (c) 2014 N_H <h.10x64@gmail.com>
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 * 
 **/
snd.CLASS_DEF.push(function(){snd.OscillatorSource=function(){snd.Source.apply(this,arguments),this._periodicWave=null,this._source=null,this.listeners={onended:[]},Object.defineProperties(this,{periodicWave:{get:function(){var a={};return a.realArray=this._status.periodicWave.realArray,a.imagArray=this._status.periodicWave.imagArray,a},set:function(a){null==a?(this._periodicWave=null,this._status.periodicWave=null,this._status.oscillatorType==snd.OscillatorSource.CUSTOM&&(this._status.oscillatorType=null),this.setWaveForm()):null==a.realArray||null==a.imagArray?console.warn("periodicWave property must have realArray and imagArray."):(this._status.periodicWave={realArray:a.realArray,imagArray:a.imagArray},this._status.oscillatorType=snd.OscillatorSource.CUSTOM,this.setWaveForm())}},periodicWaveParam:{get:function(){return this._periodicWave}},oscillatorType:{get:function(){return this._status.oscillatorType},set:function(a){this._status.oscillatorType=a,this._source&&(this._source.type=a),this._periodicWave=null,this._status.periodicWave=null}},frequency:{get:function(){return null!=this._source?this._source.frequency.value:void 0},set:function(a){null!=this._source&&(this._source.frequency.value=a?parseFloat(a):0,this._status.frequency=this._source.frequency.value)}},frequencyParam:{get:function(){return null!=this._source?(null==this._source.detune.id&&(this._source.detune.id=this.id+".frequency"),this._source.frequency):void 0}},detune:{get:function(){return null!=this._source?this._source.detune.value:void 0},set:function(a){null!=this._source&&(this._source.detune.value=a?parseFloat(a):0,this._status.detune=a)}},detuneParam:{get:function(){return null!=this._source?(null==this._source.detune.id&&(this._source.detune.id=this.id+".detune"),this._source.detune):void 0}}}),this.resetOscillator()},snd.OscillatorSource.prototype=Object.create(snd.Source.prototype),snd.OscillatorSource.prototype.constructor=snd.OscillatorSource,snd.OscillatorSource.CLASS_NAME="snd.OscillatorSource",snd.OscillatorSource.DEFAULT_FREQUENCY=440,snd.OscillatorSource.SINE="sine",snd.OscillatorSource.SQUARE="square",snd.OscillatorSource.SAWTOOTH="sawtooth",snd.OscillatorSource.TRIANGLE="triangle",snd.OscillatorSource.CUSTOM="custom",snd.OscillatorSource.prototype.setWaveForm=function(){null!=this._status.periodicWave?(this._periodicWave=snd.AUDIO_CONTEXT.createPeriodicWave(this._status.periodicWave.realArray,this._status.periodicWave.imagArray),this._source.setPeriodicWave(this._periodicWave)):null!=this._status.oscillatorType&&this._status.oscillatorType!=snd.OscillatorSource.CUSTOM?this._source.type=this._status.oscillatorType:(this._source.type=snd.OscillatorSource.SINE,this._status.oscillatorType=snd.OscillatorSource.SINE,this._status.periodicWave=null,this._periodicWave=null)},snd.OscillatorSource.prototype.setOscillatorType=function(a){null!=this._source&&(this._source.type=a)},snd.OscillatorSource.prototype.getOscillatorType=function(){return this.oscillatorType},snd.OscillatorSource.prototype.setFrequency=function(a){this.frequency=a},snd.OscillatorSource.prototype.getFrequency=function(){return this.frequency},snd.OscillatorSource.prototype.setDetune=function(a){this.detune=a},snd.OscillatorSource.prototype.getDetune=function(){return this.detune},snd.OscillatorSource.prototype.setPeriodicWave=function(a,b){this.periodicWave={realArray:a,imagArray:b}},snd.OscillatorSource.prototype.getPeriodicWave=function(){return this._periodicWave},snd.OscillatorSource.prototype.start=function(a){this.status==snd.status.STOPPED&&this.resetOscillator(),null!=this._source&&this.status!=snd.status.STARTED&&this.status!=snd.status.STOPPED&&(this._source.start(null==a?0:a),this._status.status=snd.status.STARTED)},snd.OscillatorSource.prototype.stop=function(a){this.status==snd.status.STARTED&&(this._source.stop(null==a?0:a),this._status.status=snd.status.STOPPED)},snd.OscillatorSource.prototype.resetOscillator=function(){var a=this;null!=this._source&&this.status==snd.status.STARTED&&this.stop(0),this._source=snd.AUDIO_CONTEXT.createOscillator(),this._source.onended=function(){a.fireOnEndedEvent()},this.setWaveForm(),this._source.connect(this._gain),this._status.status=snd.status.READY},snd.OscillatorSource.prototype.addOnEndedEventListener=function(a){this.listeners.onended.push(a)},snd.OscillatorSource.prototype.removeOnEndedEventListener=function(a){for(var b=this.listeners.onended,c=0;c<b.length;c++)if(b[c]===a){b.splice(c,1);break}},snd.OscillatorSource.prototype.onended=function(){},snd.OscillatorSource.prototype.fireOnEndedEvent=function(){"function"==typeof this.onended&&this.onended(this);for(var a=this.listeners.onended,b=0;a>b;b++)"function"==typeof a[b]&&a[b](this)},snd.OscillatorSource.prototype.createStatus=function(){return new snd.OscillatorSource.Status},snd.OscillatorSource.prototype.toJSON=function(){return this._status},snd.OscillatorSource.prototype.loadData=function(a){snd.Source.prototype.loadData.apply(this,arguments),null!=a.periodicWave?(this._status.periodicWave=a.periodicWave,this._status.oscillatorType=snd.OscillatorSource.CUSTOM):(this._status.oscillatorType=a.oscillatorType,this._status.periodicWave=null),this.setWaveForm(),this.frequency=a.frequency,this.detune=a.detune},snd.OscillatorSource.loadJSON=function(a){var b=JSON.parse(a);if(b.className!=snd.OscillatorSource.CLASS_NAME)throw new snd.Exception(b.id+" is not instance of 'snd.OscillatorSource' class.");var c=new snd.OscillatorSource("");return c.loadData(b),c},snd.OscillatorSource.Status=function(){snd.Source.Status.apply(this,arguments),this.className=snd.OscillatorSource.CLASS_NAME,this.type=snd.srctype.OSCILLATOR,this.status=snd.status.NONE,this.periodicWave=null,this.oscillatorType=null,this.frequency=snd.OscillatorSource.DEFAULT_FREQUENCY,this.detune=0}});