/**
 * snd.js - The Sound Library for JavaScript with WebAudioAPI - v.1.0 beta
 * 
 * The MIT License (MIT)
 * copyright (c) 2014 N_H <h.10x64@gmail.com>
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 * 
 **/
snd.CLASS_DEF.push(function(){snd.AudioDataManager=function(){this._requests={},this._dataMap={},this._eventListeners={},this._allLoadEventListeners=[],Object.defineProperties(this,{data:{get:function(){for(var a={},b=Object.keys(this._dataMap),c=0;c<b.length;c++)!function(a,b,c){var d={};d[b]={get:function(){return c._dataMap[b].data}},Object.defineProperties(a,d)}(a,b[c],this);return a}}})},snd.AudioDataManager.prototype.onload=function(){for(var a=0;a<this._allLoadEventListeners.length;a++)this._allLoadEventListeners[a]()},snd.AudioDataManager.prototype.addAllDataLoadListener=function(a){this._allLoadEventListeners.push(a)},snd.AudioDataManager.prototype.removeAllDataLoadListener=function(a){for(var b=0;b<this._allLoadEventListeners.length;b++){var c=this._allLoadEventListeners[b];if(c===a)return this._allLoadEventListeners.splice(b,1),!0}return!1},snd.AudioDataManager.prototype.addOnLoadListener=function(a,b){null==this._eventListeners[a]&&(this._eventListeners[a]={onload:[]}),this._eventListeners[a].onload.push(b)},snd.AudioDataManager.prototype.removeOnLoadListener=function(a){return null!=this._eventListeners[a]?(delete this._eventListeners[a],!0):!1},snd.AudioDataManager.prototype.getAudioBuffer=function(a){return null!=this._dataMap[a]?this._dataMap[a].data:void 0},snd.AudioDataManager.prototype.add=function(a,b){var c=this;this._dataMap[a]={doesLoaded:!1};var d=new XMLHttpRequest;d.open("GET",b,!0),d.responseType="arraybuffer",d.onload=function(){snd.AUDIO_CONTEXT.decodeAudioData(d.response,function(b){c._dataMap[a].data=b,c._dataMap[a].doesLoaded=!0,c.loaded(a,b)})},this._requests[a]=d},snd.AudioDataManager.prototype.addBase64=function(a,b){var c=this;this._dataMap[a]={doesLoaded:!1};var d="",e=b.toLowerCase().match(/^data:audio.*base64,(.*)$/);d=e?e[1]:b;for(var f=atob(d),g=new ArrayBuffer(f.length),h=new Uint8Array(g),i=0;i<g.byteLength;i++)h[i]=255&f.charCodeAt(i);this._requests[a]={},this._requests[a].send=function(){snd.AUDIO_CONTEXT.decodeAudioData(g,function(b){c.loaded(a,b)})}},snd.AudioDataManager.prototype.doesAllDataLoaded=function(){for(var a in this._dataMap)if(!this._dataMap[a].doesLoaded)return!1;return!0},snd.AudioDataManager.prototype.addAll=function(a){for(var b=Object.keys(a),c=0;c<b.length;c++){var d=b[c],e=a[d];if(null!=e){var f=e.match(/^data:audio.*base64,(.*)$/);if(f){var g=f[1];this.addBase64(d,g)}else this.add(d,e)}}},snd.AudioDataManager.prototype.removeData=function(a){null!=this._requests[a]&&delete this._requests[a],null!=this._dataMap[a]&&delete this._dataMap[a],null!=this._eventListeners[a]&&delete this.eventLiteners[a]},snd.AudioDataManager.prototype.removeAll=function(a){for(var b=0;b<a.length;b++)removeData(a[b])},snd.AudioDataManager.prototype.load=function(a){if(null==a)for(var b=Object.keys(this._requests),c=0;c<b.length;c++){var d=b[c];0==this._dataMap[d].doesLoaded&&(null==this._requests[d].readyState||this._requests[d].readyState<2)&&this._requests[d].send()}else(null==this._requests[a].readyState||this._requests[a].readyState<2)&&this._requests[a].send()},snd.AudioDataManager.prototype.loaded=function(a,b){if(this._dataMap[a].data=b,this._dataMap[a].doesLoaded=!0,null!=this._eventListeners[a])for(var c=0;c<this._eventListeners[a].onload.length;c++)this._eventListeners[a].onload[c](b);for(var d in this._dataMap)if(!this._dataMap[d].doesLoaded)return;this.onload()}});