/**
 * snd.js - The Sound Library for JavaScript with WebAudioAPI - v.1.0 beta
 * 
 * The MIT License (MIT)
 * copyright (c) 2014 N_H <h.10x64@gmail.com>
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 * 
 **/
snd.invalid={varsion:"0.1.20150213",isBeta:!0},snd.invalid.CLASS_DEF=[],snd.invalid.TAG_DEF={},jQuery&&jQuery.cssHooks&&(snd.invalid.doesCSSHooked={}),snd.PLUGIN_INIT.push(function(){snd.invalid.init=function(){for(var a=0;a<snd.invalid.CLASS_DEF.length;a++)snd.invalid.CLASS_DEF[a]();var b=new MutationObserver(snd.invalid.observeCallback);b.observe(document.body,{childList:!0,subTree:!0});for(var c=Object.keys(snd.invalid.TAG_DEF),a=0;a<c.length;a++)for(var d=c[a],e=document.getElementsByTagName(d),f=0;f<e.length;f++){var g=e[f];snd.invalid.Element.setup(g,snd.invalid.TAG_DEF[d])}for(var a=0;a<c.length;a++)for(var d=c[a],e=document.getElementsByTagName(d),f=0;f<e.length;f++){var g=e[f];g._invalid&&g._invalid.setConnectTo()}},snd.invalid.observeCallback=function(a,b){for(var c=0;c<a.length;c++){var d=a[c],e=d.target;if("childList"==d.type){for(var c=0;c<d.addedNodes.length;c++){var f=d.addedNodes[c],g=f._invalid;if(!g){var h=f.tagName.toLowerCase();if(!(h in snd.invalid.TAG_DEF))continue;snd.invalid.Element.setup(f,snd.invalid.TAG_DEF[h]),f._invalid.setConnectTo()}}for(var c=0;c<d.removedNodes.length;c++){var f=d.removedNodes[c],g=f._invalid;g&&g.disconnectFromAll()}var i=snd.invalid.getMethod(e,"nodeCallback");"function"==typeof i&&i(d,b)}else{var g=e._invalid;if(g)if("attributes"==d.type){var j=snd.invalid.getMethod(e,"attributeCallback");"function"==typeof j&&j(d,b);var k=d.attributeName;k&&g.changeAttribute(d,b)}else if("characterData"==d.type){var l=snd.invalid.getMethod(e,"characterDataCallback");"function"==typeof l&&l(d,b)}}}},snd.invalid.getSetting=function(a){if(a._invalid){for(var b=a._invalid,c=b._settings,d=1;d<arguments.length;d++){var e=arguments[d];if(!c[e])return void 0;c=c[e]}return c}return void 0},snd.invalid.getMethod=function(a){if(!a._invalid||!a._invalid._obj)return void 0;var b=snd.invalid.getSetting.apply(this,arguments);return"string"==typeof b?a._invalid._obj[b]:void 0},snd.invalid.attributeCallback=function(a,b){for(var c=0;c<a.length;c++){var d=a[c],e=d.target._invalid;if(e){var f=e._settings.attributeCallback;"function"==typeof e._obj[f]&&e._obj[f](a,b)}var g=[];if(e._lastAttributes)for(var c=0;c<d.target.attributes;c++)d.target.attributes[c].nodeValue!=e._lastAttributes[c].nodeValue&&g.push(d.target.attributes[c].nodeName);else for(var c=0;c<d.target.attributes;c++)g.push(d.target.attributes[c].nodeName);e.changeAttribute(g),e._lastAttributes=d.target.attributes}},snd.invalid.Element=function(a,b){var c=b["class"];this._htmlElem=a,this._settings=b,this._observer=new MutationObserver(snd.invalid.observeCallback),this._connection={"in":{},out:{}},this._obj=new c(a.id),this._lastAttribute={},this._observer.observe(a,{childlist:!0,attributes:!0})},snd.invalid.Element.prototype.setAttribute=function(a){if("style"==a)this.setStyle();else if("connectto"!=a){var b=snd.invalid.getSetting(this._htmlElem,"attributes",a),c=this._htmlElem.getAttribute(a);if(b)"function"==b.type?this._obj[b.name](c):"property"==b.type&&(this._obj[b.name]=c);else{var d=snd.invalid.getSetting(this._htmlElem,"events",a);if(d){var e=this;this._obj[d]=function(){window.eval(e._htmlElem.getAttribute(d))}}}}},snd.invalid.Element.prototype.setConnectTo=function(){var a,b=this._htmlElem.getAttribute("connectto");a="string"==typeof b?b.replace(/^\s*/,"").replace(/\s*$/,"").replace(/\s+/gm," ").split(","):b,this.changeConnectTo(a)},snd.invalid.Element.prototype.setStyle=function(){for(var a=snd.invalid.Element.parseStyleAttribute(this._htmlElem),b=Object.keys(a),c=0;c<b.length;c++){var d=b[c],e=snd.invalid.getSetting(this._htmlElem,"styles",d);e&&("function"==e.type?this._obj[e.name](a[d]):"property"==e.type&&(this._obj[e.name]=a[d]))}},snd.invalid.Element.prototype.changeAttribute=function(a){var b=a.attributeName.toLowerCase();"connectto"==b?this.setConnectTo():this.setAttribute(b)},snd.invalid.Element.prototype.changeStyle=function(){setStyle()},snd.invalid.Element.prototype.changeConnectTo=function(a){if(a){for(var b=Object.keys(this._connection.out),c=0;c<b.length;c++)a.indexOf(b[c])<0&&this.disconnect(b[c]);for(var c=0;c<a.length;c++)this._connection.out[a[c]]||this.connect(a[c])}Object.keys(this._connection.out).length<=0&&this.connect("MASTER")},snd.invalid.Element.prototype.connected=function(a){a._invalid._connection.out["#"+a.id]=!0,this._connection["in"]["#"+a.id]=!0},snd.invalid.Element.prototype.connect=function(a){var b=a.replace(/^\s*/,"").replace(/\s$/,"");if("MASTER"==b.toUpperCase())return this._obj.connect(snd.MASTER),void(this._connection.out.MASTER=!0);if(b)for(var c=document.querySelectorAll(b),d=0;d<c.length;d++){var e=c[d];if(e&&!this._connection.out["#"+e.id]){if(!e._invalid)return void console.log("Tag #"+e.id+" isn't snd-tag.");this._obj.connect(e._invalid._obj),this._connection.out["#"+e.id]=!0,e._invalid.connected(e)}}},snd.invalid.Element.prototype.disconnected=function(a){delete a._invalid._connection.out["#"+a.id],delete this._connection["in"]["#"+a.id]},snd.invalid.Element.prototype.disconnect=function(a){if("MASTER"==a.toUpperCase())return this._obj.disconnect(snd.MASTER),void delete this._connection.out.MASTER;if(a)for(var b=document.querySelectorAll(a),c=0;c<b.length;c++){var d=b[c];if(d&&this._connection.out["#"+d.id]){if(!d._invalid)return void console.log("Tag #"+d.id+" isn't snd-tag.");this._obj.disconnect(d._invalid._obj),delete this._connection.out["#"+d.id],d._invalid.disconnected(d)}}},snd.invalid.Element.prototype.disconnectFromAll=function(){var a=Object.keys(this._connection.out);if(a.length>0)for(var b=0;b<a.length;b++)this.disconnect(a[b]);if(a=Object.keys(this._connection["in"]),a.length>0)for(var b=0;b<a.length;b++){var c=document.querySelector(a[b]);c&&c._invalid._obj.disconnect(this._obj)}},snd.invalid.Element.setup=function(a,b){var c=new snd.invalid.Element(a,b);a._invalid=c;for(var d=b.styles,e=b.methods,f=b.parameters,g=Object.keys(d),h=0;h<g.length;h++)!function(a,b){var c=a,e=d[g[c]],f=function(){return void 0},h=function(){};"function"==e.type?(f=function(){return b._invalid._obj[e.func.getter]()},h=function(a){return b._invalid._obj[e.func.setter](a)}):"property"==e.type&&(f=function(){return b._invalid._obj[e.name]},h=function(a){return b._invalid._obj[e.name]=a}),Object.defineProperty(b.style,g[c],{get:function(){return f()},set:function(a){h(a)}})}(h,a);for(var i=0;i<a.attributes.length;i++)a._invalid.setAttribute(a.attributes[i].name);g=Object.keys(e);for(var h=0;h<g.length;h++)!function(a,b){var c=a,d=e[g[c]];b[g[c]]=function(){b._invalid._obj[d].apply(b._invalid._obj,arguments)}}(h,a);if(f&&f.length>0)for(var i=0;i<f.length;i++){var j=f[i];snd.invalid.ParamElement.setup(a,j)}if(jQuery&&jQuery.cssHooks&&(d=b.styles)){g=Object.keys(d);for(var i=0;i<g.length;i++){var k=g[i];!function(a){var b=a;jQuery.cssHooks[b]||(jQuery.cssHooks[b]={get:function(a){return a.style[b]},set:function(a,c){a.style[b]=c}})}(k)}}},snd.invalid.Element.parseStyleAttribute=function(a){if(!a)return void 0;var b=a.getAttribute("style");if(!b)return void 0;for(var c={},d=b.split(";"),e=0;e<d.length;e++){var f=d[e].replace(/\s+/gm," ").replace(/^\s*/,"").replace(/\s*$/,""),g=f.split(":");c[g[0]]=g[1]}return c},snd.invalid.ParamElement=function(a,b){this._htmlElem=a,this._obj=b,this._connection={"in":{}}},snd.invalid.ParamElement.setup=function(a,b){var c=document.createElement(b.name),d=a._invalid._obj[b.param],e=new snd.invalid.ParamElement(c,d);c._invalid=e,a.appendChild(c)},snd.invalid.ParamElement.prototype.connected=function(a){var b=this._htmlElem.parentNode;if(!b)throw new snd.Exception("#"+this._htmlElem.id+" have not parent node.");if(!b._invalid)throw new snd.Exception("#"+b.id+" isn't snd-tag.(or lost _invalid accidentary.)");b._invalid._connection["in"]["#"+a.id]=!0,a._invalid._connection["in"]["#"+this._htmlElem.id]=!0},snd.invalid.ParamElement.prototype.disconnected=function(a){var b=this._htmlElem.parentNode;if(!b)throw new snd.Exception("#"+this._htmlElem.id+" have not parent node.");if(!b._invalid)throw new snd.Exception("#"+b.id+" isn't snd-tag.(or lost _invalid accidentary.)");delete b._invalid._connection["in"]["#"+a.id],delete a._invalid._connection.out["#"+this._htmlElem.id]}});