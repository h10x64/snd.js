/**
 * snd.js - The Sound Library for JavaScript with WebAudioAPI - v.1.0 beta
 * 
 * The MIT License (MIT)
 * copyright (c) 2014 - 2015 N_H <h.10x64@gmail.com>
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 * 
 **/
!function(a,b){"function"==typeof define&&define.amd?define(["snd.util","snd.TimeLineEvent","snd.Envelope"],b):"object"==typeof exports||(a.snd=b(a.snd))}(this,function(a){a.TimeLine=function(b){this._id=b,this._interval=.25,this._queueingLength=4*this._interval,this._startAt=0,this._startedTime=0,this._elapsedTime=-1,this._events=[],this._intervalTimer=null,this._lastEventId=0,this._status=a.status.READY,Object.defineProperties(this,{id:{get:function(){return this._id}},status:{get:function(){return this._status}},startAt:{get:function(){return this._startAt},set:function(a){return 0>=a?void console.log("TimeLine.startAt must greater than 0s."):void this.setStartAt(a)}},elapsedTime:{get:function(){return this.status!=a.status.STARTED?0:a.CURRENT_TIME-this._startedTime}},now:{get:function(){return this.status!=a.status.STARTED?this._startAt:this._startAt+this.elapsedTime}},interval:{get:function(){return this._interval},set:function(a){return 0>=a?void console.log("TimeLine.interval must greater than 0s."):void(this._interval=a)}},queueingLength:{get:function(){return this._queueingLength},set:function(a){return 0>=a?void console.log("TimeLine.queueingLength must greater than 0s."):void(this._queueingLength=a)}}})},a.TimeLine.prototype.push=function(b){var c=this;b.addStartTimeChangedEventListener(function(a,b){c.onTimeLineEventStartTimeChanged(a,b)}),this._events.push(b),this._events.sort(a.TimeLineEvent.compare),this.onTimeLineEventAdded(b)},a.TimeLine.prototype.onTimeLineEventAdded=function(){},a.TimeLine.prototype.size=function(){return this._events.length},a.TimeLine.prototype.getEvent=function(a){return a>=0&&a<this._events.length?this._events[a]:void console.log("Index out of range. Return undefined. (timeline.size = "+this._events.length+", i = "+a+")")},a.TimeLine.prototype.removeEvent=function(a){var b=this._events.indexof(a);this.remove(b)},a.TimeLine.prototype.remove=function(a){if(a>=0&&a<this._events.length){var b=this,c=this._events[a];c.removeStartTimeChangedEventListener(function(a,c){b.onTimeLineEventStartTimeChanged(a,c)}),this._events.splice(a,1),this.onTimeLineEventRemoved(c)}},a.TimeLine.prototype.onTimeLineEventRemoved=function(){},a.TimeLine.prototype.start=function(){return this.status==a.status.STARTED?void console.log("TimeLine already started."):this.interval<=0?void console.log("TimeLine.interval must more or equals than 0.0s"):this.endTime<=0?void console.log("TimeLine.endTime must more than 0.0s"):(this._status=a.status.STARTED,this._startedTime=a.CURRENT_TIME,this.startInterval(),void this.onstarted(this._startedTime))},a.TimeLine.prototype.onstarted=function(){},a.TimeLine.prototype.stop=function(b){var c=this.now;this._intervalTimer.stop();var d=this.searchEvents(c);for(var e in d)d[e].stop(b);this.resetAllEvents(),this._status=a.status.READY,this.onstopped(this.now)},a.TimeLine.prototype.onstopped=function(){},a.TimeLine.prototype.setStartAt=function(a){null!=this._currentEvents&&(this.stop(),this._currentEvents=null),this._startAt=a,this.onStartAtChanged(a)},a.TimeLine.prototype.onStartAtChanged=function(){};var b=null;return a.TimeLine.prototype.tick=function(c){if(!(null!=b&&b>=a.CURRENT_TIME)){var d=c._this,e=d.now,f=d.searchEventsBySpan(e,e+d.queueingLength);for(var g in f){var h=f[g];h.status!=a.status.STARTED&&h.status!=a.status.STOPPED&&h.start(e)}b=a.CURRENT_TIME}},a.TimeLine.prototype.startInterval=function(){var b=this;this._intervalTimer||(this._intervalTimer=a.util.createIntervalTimer(b.tick,1e3*b.interval,{_this:b})),this.tick({_this:b}),this._intervalTimer.start()},a.TimeLine.prototype.resetAllEvents=function(){for(var a=0;a<this._events.length;a++)this._events[a].resetStatus()},a.TimeLine.prototype.searchEventsBySpan=function(a,b){for(var c=[],d=0;d<this._events.length;d++){var e=this._events[d].startTime,f=this._events[d].endTime;if(f>=a&&b>=e||f>=a&&b>=f||a>=e&&f>=a||b>=e&&f>=b)c.push(this._events[d]);else if(e>b)break}return c},a.TimeLine.prototype.searchEvents=function(a){for(var b=[],c=0;c<this._events.length;c++){var d=this._events[c].startTime,e=this._events[c].endTime;a>=d&&e>=a&&b.push(this._events[c])}return b},a.TimeLine.prototype.onTimeLineEventStartTimeChanged=function(){this._events.sort(a.TimeLineEvent.compare)},a});