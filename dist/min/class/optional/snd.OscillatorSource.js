/**
 * snd.js - The Sound Library for JavaScript with WebAudioAPI - v.1.0 beta
 * 
 * The MIT License (MIT)
 * copyright (c) 2014 - 2015 N_H <h.10x64@gmail.com>
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 * 
 **/
!function(a,b){"function"==typeof define&&define.amd?define(["snd.Source"],b):"object"==typeof exports||(a.snd=b(a.snd))}(this,function(a){return a.OscillatorSource=function(){a.Source.apply(this,arguments),this._periodicWave=null,this._sources=[],this._frequencyGain=null,this._detuneGain=null,this.listeners={onended:[]},Object.defineProperties(this,{periodicWave:{get:function(){var a={};return a.realArray=this._status.periodicWave.realArray,a.imagArray=this._status.periodicWave.imagArray,a},set:function(b){null==b?(this._periodicWave=null,this._status.periodicWave=null,this._status.oscillatorType==a.OscillatorSource.CUSTOM&&(this._status.oscillatorType=null),this.setWaveForm()):null==b.realArray||null==b.imagArray?console.warn("periodicWave property must have realArray and imagArray."):(this._status.periodicWave={realArray:b.realArray,imagArray:b.imagArray},this._status.oscillatorType=a.OscillatorSource.CUSTOM,this.setWaveForm())}},oscillatorType:{get:function(){return this._status.oscillatorType},set:function(a){if(this._sources.length>0)for(var b in this._sources)this._sources[b].type=a;this._status.oscillatorType=a,this._periodicWave=null,this._status.periodicWave=null}},frequency:{get:function(){return this._sources.length>0?this._sources[0].frequency.value:void 0},set:function(a){if(this._sources.length>0){var b=a?parseFloat(a):0;for(var c in this._sources)this._sources[c].frequency.value=b;this._status.frequency=this._sources.frequency.value}}},frequencyParam:{get:function(){return null!=this._sources?this.modAudioParam("frequency",this._frequencyGain):void 0}},detune:{get:function(){return null!=this._sources?this._sources.detune.value:void 0},set:function(a){null!=this._sources&&(this._sources.detune.value=a?parseFloat(a):0,this._status.detune=a)}},detuneParam:{get:function(){return null!=this._sources?this.modAudioParam("detune",this._detuneGain):void 0}}})},a.OscillatorSource.prototype=Object.create(a.Source.prototype),a.OscillatorSource.prototype.constructor=a.OscillatorSource,a.OscillatorSource.CLASS_NAME="snd.OscillatorSource",a.OscillatorSource.DEFAULT_FREQUENCY=440,a.OscillatorSource.SINE="sine",a.OscillatorSource.SQUARE="square",a.OscillatorSource.SAWTOOTH="sawtooth",a.OscillatorSource.TRIANGLE="triangle",a.OscillatorSource.CUSTOM="custom",a.OscillatorSource.prototype.setWaveForm=function(b){null!=this._status.periodicWave?(this._periodicWave=a.AUDIO_CONTEXT.createPeriodicWave(this._status.periodicWave.realArray,this._status.periodicWave.imagArray),b.setPeriodicWave(this._periodicWave)):null!=this._status.oscillatorType&&this._status.oscillatorType!=a.OscillatorSource.CUSTOM?b.type=this._status.oscillatorType:(b.type=a.OscillatorSource.SINE,this._status.oscillatorType=a.OscillatorSource.SINE,this._status.periodicWave=null,this._periodicWave=null)},a.OscillatorSource.prototype.start=function(b,c,d){var e=this.addOscillator(),f=b?b:0;e.start(f),this._status.status=a.status.STARTED,null!=d&&this.stop(b+d)},a.OscillatorSource.prototype.stop=function(b){if(this._status.status==a.status.STARTED){var c=b?b:0;for(var d in this._sources)this._sources[d].stop(c);this._status.status=a.status.STOPPED}},a.OscillatorSource.prototype.addOscillator=function(){var b=this,c=a.AUDIO_CONTEXT.createOscillator();this.initializeOscillator(c),this._sources.push(c);var d=b._sources.length-1;return b._sources[d].onended=function(){b._sources.splice(d,1),b.fireOnEndedEvent(this)},c},a.OscillatorSource.prototype.removeOscillator=function(a){a.disconnect(this._gain),this._frequencyGain&&this._frequencyGain.removeAudioParam(a.frequency),this._detuneGain&&this._detuneGain.removeAudioParam(a.detune);var b=this._sources.indexOf(a);this._sources.splice(b,1)},a.OscillatorSource.prototype.initializeOscillator=function(a){this.setWaveForm(a),a.detune.value=this._status.detune,a.frequency.value=this._status.frequency,this._frequencyGain?this._frequencyGain.addAudioParam(a.frequency):(this._frequencyGain=this.createParamGain(),this._frequencyGain.addAudioParam(a.frequency)),this._detuneGain?this._detuneGain.addAudioParam(a.detune):(this._detuneGain=this.createParamGain(),this._detuneGain.addAudioParam(a.detune)),a.connect(this._gain)},a.OscillatorSource.prototype.addOnEndedEventListener=function(a){this.listeners.onended.push(a)},a.OscillatorSource.prototype.removeOnEndedEventListener=function(a){for(var b=this.listeners.onended,c=0;c<b.length;c++)if(b[c]===a){b.splice(c,1);break}},a.OscillatorSource.prototype.onended=function(){},a.OscillatorSource.prototype.fireOnEndedEvent=function(a){"function"==typeof this.onended&&this.onended(this);for(var b=this.listeners.onended,c=0;b>c;c++)"function"==typeof b[c]&&b[c](this);this.removeOscillator(a)},a.OscillatorSource.prototype.getParamDescription=function(){var b=a.Source.prototype.getParamDescription.apply(this,arguments);return b.periodicWave={type:a.params.type.VALUE,"default":void 0,max:void 0,min:void 0},b.oscillatorType={type:a.params.type.ENUM,value:[a.OscillatorSource.SINE,a.OscillatorSource.SQUARE,a.OscillatorSource.SAWTOOTH,a.OscillatorSource.TRIANGLE,a.OscillatorSource.CUSTOM],"default":a.OscillatorSource.SINE},b.frequency={type:a.params.type.VALUE,"default":a.OscillatorSource.DEFAULT_FREQUENCY,max:1/0,min:-1/0},b.detune={type:a.params.type.VALUE,"default":0,max:1/0,min:-1/0},b.frequencyParam={type:a.params.type.AUDIO_PARAM,audioParam:this.frequencyParam,"default":b.frequency["default"],max:b.frequency.max,min:b.frequency.min},b.detuneParam={type:a.params.type.AUDIO_PARAM,audioParam:this.detuneParam,"default":b.detune["default"],max:b.detune.max,min:b.detune.min},b},a.OscillatorSource.prototype.createStatus=function(){return new a.OscillatorSource.Status},a.OscillatorSource.prototype.toJSON=function(){return this._status},a.OscillatorSource.prototype.loadData=function(b){a.Source.prototype.loadData.apply(this,arguments),null!=b.periodicWave?(this._status.periodicWave=b.periodicWave,this._status.oscillatorType=a.OscillatorSource.CUSTOM):(this._status.oscillatorType=b.oscillatorType,this._status.periodicWave=null),this.setWaveForm(),this.frequency=b.frequency,this.detune=b.detune},a.OscillatorSource.loadJSON=function(b){var c=JSON.parse(b);if(c.className!=a.OscillatorSource.CLASS_NAME)throw new a.Exception(c.id+" is not instance of 'snd.OscillatorSource' class.");var d=new a.OscillatorSource("");return d.loadData(c),d},a.OscillatorSource.Status=function(){a.Source.Status.apply(this,arguments),this.className=a.OscillatorSource.CLASS_NAME,this.type=a.srctype.OSCILLATOR,this.status=a.status.NONE,this.periodicWave=null,this.oscillatorType=null,this.frequency=a.OscillatorSource.DEFAULT_FREQUENCY,this.detune=0},a});