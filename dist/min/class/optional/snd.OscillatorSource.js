/**
 * snd.js - The Sound Library for JavaScript with WebAudioAPI - v.1.0 beta
 * 
 * The MIT License (MIT)
 * copyright (c) 2014 - 2015 N_H <h.10x64@gmail.com>
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 * 
 **/
!function(a,b){"function"==typeof define&&define.amd?define(["snd.Source"],b):"object"==typeof exports||(a.snd=b(a.snd))}(this,function(a){return a.OscillatorSource=function(){a.Source.apply(this,arguments),this._periodicWave=null,this._source=null,this._frequencyGain=null,this._detuneGain=null,this.listeners={onended:[]},Object.defineProperties(this,{periodicWave:{get:function(){var a={};return a.realArray=this._status.periodicWave.realArray,a.imagArray=this._status.periodicWave.imagArray,a},set:function(b){null==b?(this._periodicWave=null,this._status.periodicWave=null,this._status.oscillatorType==a.OscillatorSource.CUSTOM&&(this._status.oscillatorType=null),this.setWaveForm()):null==b.realArray||null==b.imagArray?console.warn("periodicWave property must have realArray and imagArray."):(this._status.periodicWave={realArray:b.realArray,imagArray:b.imagArray},this._status.oscillatorType=a.OscillatorSource.CUSTOM,this.setWaveForm())}},oscillatorType:{get:function(){return this._status.oscillatorType},set:function(a){this._status.oscillatorType=a,this._source&&(this._source.type=a),this._periodicWave=null,this._status.periodicWave=null}},frequency:{get:function(){return null!=this._source?this._source.frequency.value:void 0},set:function(a){null!=this._source&&(this._source.frequency.value=a?parseFloat(a):0,this._status.frequency=this._source.frequency.value)}},frequencyParam:{get:function(){return null!=this._source?this.modAudioParam("frequency",this._frequencyGain):void 0}},detune:{get:function(){return null!=this._source?this._source.detune.value:void 0},set:function(a){null!=this._source&&(this._source.detune.value=a?parseFloat(a):0,this._status.detune=a)}},detuneParam:{get:function(){return null!=this._source?this.modAudioParam("detune",this._detuneGain):void 0}}}),this.resetOscillator()},a.OscillatorSource.prototype=Object.create(a.Source.prototype),a.OscillatorSource.prototype.constructor=a.OscillatorSource,a.OscillatorSource.CLASS_NAME="snd.OscillatorSource",a.OscillatorSource.DEFAULT_FREQUENCY=440,a.OscillatorSource.SINE="sine",a.OscillatorSource.SQUARE="square",a.OscillatorSource.SAWTOOTH="sawtooth",a.OscillatorSource.TRIANGLE="triangle",a.OscillatorSource.CUSTOM="custom",a.OscillatorSource.prototype.setWaveForm=function(){null!=this._status.periodicWave?(this._periodicWave=a.AUDIO_CONTEXT.createPeriodicWave(this._status.periodicWave.realArray,this._status.periodicWave.imagArray),this._source.setPeriodicWave(this._periodicWave)):null!=this._status.oscillatorType&&this._status.oscillatorType!=a.OscillatorSource.CUSTOM?this._source.type=this._status.oscillatorType:(this._source.type=a.OscillatorSource.SINE,this._status.oscillatorType=a.OscillatorSource.SINE,this._status.periodicWave=null,this._periodicWave=null)},a.OscillatorSource.prototype.setOscillatorType=function(a){null!=this._source&&(this._source.type=a)},a.OscillatorSource.prototype.getOscillatorType=function(){return this.oscillatorType},a.OscillatorSource.prototype.setFrequency=function(a){this.frequency=a},a.OscillatorSource.prototype.getFrequency=function(){return this.frequency},a.OscillatorSource.prototype.setDetune=function(a){this.detune=a},a.OscillatorSource.prototype.getDetune=function(){return this.detune},a.OscillatorSource.prototype.setPeriodicWave=function(a,b){this.periodicWave={realArray:a,imagArray:b}},a.OscillatorSource.prototype.getPeriodicWave=function(){return this._periodicWave},a.OscillatorSource.prototype.start=function(b,c,d){this.status==a.status.STOPPED&&this.resetOscillator(),null!=this._source&&this.status!=a.status.STARTED&&this.status!=a.status.STOPPED&&(this._source.start(null!=b?b:0),this._status.status=a.status.STARTED,null!=d&&this.stop(a.CURRENT_TIME+b+d))},a.OscillatorSource.prototype.stop=function(b){this.status==a.status.STARTED&&(this._source.stop(null==b?0:b),this._status.status=a.status.STOPPED)},a.OscillatorSource.prototype.resetOscillator=function(){var b=this;null!=this._source&&this.status==a.status.STARTED&&this.stop(0),this._source=a.AUDIO_CONTEXT.createOscillator(),this._source.onended=function(){b.fireOnEndedEvent()},this.setWaveForm(),this.detune=this._status.detune,this.frequency=this._status.frequency,this._frequencyGain?this._frequencyGain.setAudioParam(this._source.frequency):this._frequencyGain=this.createParamGain(this._source.frequency),this._detuneGain?this._detuneGain.setAudioParam(this._source.detune):this._detuneGain=this.createParamGain(this._source.detune),this._source.connect(this._gain),this._status.status=a.status.READY},a.OscillatorSource.prototype.addOnEndedEventListener=function(a){this.listeners.onended.push(a)},a.OscillatorSource.prototype.removeOnEndedEventListener=function(a){for(var b=this.listeners.onended,c=0;c<b.length;c++)if(b[c]===a){b.splice(c,1);break}},a.OscillatorSource.prototype.onended=function(){},a.OscillatorSource.prototype.fireOnEndedEvent=function(){"function"==typeof this.onended&&this.onended(this);for(var a=this.listeners.onended,b=0;a>b;b++)"function"==typeof a[b]&&a[b](this)},a.OscillatorSource.prototype.createStatus=function(){return new a.OscillatorSource.Status},a.OscillatorSource.prototype.toJSON=function(){return this._status},a.OscillatorSource.prototype.loadData=function(b){a.Source.prototype.loadData.apply(this,arguments),null!=b.periodicWave?(this._status.periodicWave=b.periodicWave,this._status.oscillatorType=a.OscillatorSource.CUSTOM):(this._status.oscillatorType=b.oscillatorType,this._status.periodicWave=null),this.setWaveForm(),this.frequency=b.frequency,this.detune=b.detune},a.OscillatorSource.loadJSON=function(b){var c=JSON.parse(b);if(c.className!=a.OscillatorSource.CLASS_NAME)throw new a.Exception(c.id+" is not instance of 'snd.OscillatorSource' class.");var d=new a.OscillatorSource("");return d.loadData(c),d},a.OscillatorSource.Status=function(){a.Source.Status.apply(this,arguments),this.className=a.OscillatorSource.CLASS_NAME,this.type=a.srctype.OSCILLATOR,this.status=a.status.NONE,this.periodicWave=null,this.oscillatorType=null,this.frequency=a.OscillatorSource.DEFAULT_FREQUENCY,this.detune=0},a});