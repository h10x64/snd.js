/**
 * snd.js - The Sound Library for JavaScript with WebAudioAPI - v.1.0 beta
 * 
 * The MIT License (MIT)
 * copyright (c) 2014 - 2015 N_H <h.10x64@gmail.com>
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 * 
 **/
define(["snd.Source"],function(a){return a.Synth=function(b,c,d){a.Source.apply(this,arguments),this.polyphony=c,this._settings=d,this.partes=[];for(var e=0;e<this.polyphony;e++){var f=new a.Synth.Partes(this.id+e,this._settings);f.connect(this._gain),this.partes.push(f)}Object.defineProperty(this,"settings",{configurable:!0,enumerable:!0,get:function(){return this._settings},set:function(a){this.settings=a;for(var b=0;b<this.polyphony;b++)this.partes[b].settings=this.settings}})},a.Synth.prototype=Object.create(a.Source.prototype),a.Synth.prototype.constructor=a.Synth,a.Synth.setWaveForm=function(b){if(this.settings.waveform=b,b===a.SINE||b===a.SQUARE||b===a.SAWTOOTH||b===a.TRIANGLE)for(i=0;i<this.partes.length;i++)this.partes[i].setOscillatorType(b);else for(i=0;i<this.partes.length;i++)this.partes[i].setPeriodicWave(b)},a.Synth.prototype.noteOn=function(a){for(var b=0;b<a.length;b++){var c=a[b].no,d=a[b].freq;this.partes[c].noteOn(d)}},a.Synth.prototype.noteOff=function(a){for(var b=0;b<a.length;b++){var c=a[b].no;this.partes[c].noteOff()}},a.Synth.Partes=function(b,c){a.OscillatorSource.apply(this,arguments);var d=this;this.setGain(0),this.settings=c,this.settings.onchange=function(){d.setWaveType(d.settings.waveform)},this.ampEnvelope=new a.Envelope(this.volumeParam,this.settings.amplitude.envelope),this.ampLFO=new a.Synth.LFO(this.id+"_AmpLFO",this.volumeParam,this.settings.amplitude.lfo),this.freqEnvelope=new a.Envelope(this.frequencyParam,this.settings.frequency.envelope),this.freqLFO=new a.Synth.LFO(this.id+"_FreqLFO",this.frequencyParam,this.settings.frequency.lfo)},a.Synth.Partes.prototype=Object.create(a.OscillatorSource.prototype),a.Synth.Partes.prototype.constructor=a.Synth.Note,a.Synth.Partes.prototype.noteOn=function(a){this.freqEnvelope.settings.max=a,this.start(0),this.ampEnvelope.noteOn(),this.ampLFO.noteOn(),this.freqEnvelope.noteOn(),this.freqLFO.noteOn()},a.Synth.Partes.prototype.noteOff=function(){this.ampEnvelope.noteOff(),this.ampLFO.noteOff(),this.freqEnvelope.noteOff(),this.freqLFO.noteOff()},a.Synth.LFO=function(b,c,d){a.OscillatorSource.apply(this,arguments);var e=this;this.baseValue=0,this.param=c,this._gain.connect(this.param),this._settings=d,this.freqEnvelope=new a.Envelope(this.frequencyParam,d.frequency),this.ampEnvelope=new a.Envelope(this.volumeParam,d.amplitude),this._settings.onchange=function(){e.source.setWaveForm(e.settings.waveform)},Object.defineProperty(this,"settings",{configurable:!0,enumerable:!0,get:function(){return this._settings},set:function(a){this._settings=a,this.setWaveForm(a.waveform),this.freqEnvelope.settings=a.frequency,this.ampEnvelope.settings=a.amplitude}})},a.Synth.LFO.prototype=Object.create(a.OscillatorSource.prototype),a.Synth.LFO.prototype.constructor=a.Synth.LFO,a.Synth.LFO.prototype.noteOn=function(){this.start(0),this.ampEnvelope.noteOn(),this.freqEnvelope.noteOn()},a.Synth.LFO.prototype.noteOff=function(){this.ampEnvelope.noteOff(),this.freqEnvelope.noteOff()},a.Envelope=function(a,b){this.param=a,this.settings=b},a.Envelope.prototype.noteOn=function(){var b=a.AUDIO_CONTEXT.currentTime;if(this.param.cancelScheduledValues(b),this.param.value=0,this.settings.attackTime>=0)switch(this.settings.attackType){case a.audioparam.type.LINER:this.param.linearRampToValueAtTime(this.settings.attack*this.settings.max,b+this.settings.attackTime);break;case a.audioparam.type.EXPONENTIALLY:this.param.exponentialRampToValueAtTime(this.settings.attack*this.settings.max,b+this.settings.attackTime);break;default:this.param.setValueAtTime(this.settings.attack*this.settings.max,b+this.settings.attackTime)}if(this.settings.decayTime>0)switch(this.settings.decayType){case a.audioparam.type.LINER:this.param.linearRampToValueAtTime(this.settings.sustain*this.settings.max,b+this.settings.attackTime+this.settings.decayTime);break;case a.audioparam.type.EXPONENTIALLY:this.param.exponentialRampToValueAtTime(this.settings.sustain*this.settings.max,b+this.settings.attackTime+this.settings.decayTime);break;default:this.param.setValueAtTime(this.settings.sustain*this.settings.max,b+this.settings.attackTime+this.settings.decayTime)}if(this.settings.sustainTime>0){switch(this.settings.sustainType){case a.audioparam.type.LINER:this.param.linearRampToValueAtTime(this.settings.release*this.settings.max,b+this.settings.attackTime+this.settings.decayTime+this.settings.sustainTime);break;case a.audioparam.type.EXPONENTIALLY:this.param.exponentialRampToValueAtTime(this.settings.release*this.settings.max,b+this.settings.attackTime+this.settings.decayTime+this.settings.sustainTime);break;default:this.param.setValueAtTime(this.settings.release*this.settings.max,b+this.settings.attackTime+this.settings.decayTime+this.settings.sustainTime)}switch(this.settings.releaseType){case a.audioparam.type.LINER:this.param.linearRampToValueAtTime(0,b+this.settings.attackTime+this.settings.decayTime+this.settings.sustainTime+this.settings.releaseTime);break;case a.audioparam.type.EXPONENTIALLY:this.param.exponentialRampToValueAtTime(0,b+this.settings.attackTime+this.settings.decayTime+this.settings.sustainTime+this.settings.releaseTime);break;default:this.param.setValueAtTime(0,b+this.settings.attackTime+this.settings.decayTime+this.settings.sustainTime+this.settings.releaseTime)}}},a.Envelope.prototype.noteOff=function(){var b=a.AUDIO_CONTEXT.currentTime;switch(this.param.cancelScheduledValues(b),this.settings.releaseType){case a.audioparam.type.LINER:this.param.linearRampToValueAtTime(0,b+this.settings.releaseTime);break;case a.audioparam.type.EXPONENTIALLY:this.param.exponentialRampToValueAtTime(0,b+this.settings.releaseTime);break;default:this.param.setValueAtTime(0,b+this.settings.releaseTime)}},a.Synth.Settings=function(){this._waveform="sine",this.frequency={envelope:new a.Synth.Settings.EnvelopeSettings(440,0,1,a.audioparam.LINER,0,a.audioparam.LINER,0,0,a.audioparam.LINER,0,0,a.audioparam.LINER),lfo:new a.Synth.Settings.LFOSettings("sine",new a.Synth.Settings.EnvelopeSettings(0,0,0,a.audioparam.LINER,0,a.audioparam.LINER,0,0,a.audioparam.LINER,0,0,a.audioparam.LINER),new a.Synth.Settings.EnvelopeSettings(0,0,0,a.audioparam.LINER,0,a.audioparam.LINER,0,0,a.audioparam.LINER,0,0,a.audioparam.LINER))},this.amplitude={envelope:new a.Synth.Settings.EnvelopeSettings(.2,0,1,a.audioparam.LINER,0,a.audioparam.LINER,0,0,a.audioparam.LINER,0,0,a.audioparam.LINER),lfo:new a.Synth.Settings.LFOSettings("sine",new a.Synth.Settings.EnvelopeSettings(0,0,1,a.audioparam.LINER,0,a.audioparam.LINER,0,0,a.audioparam.LINER,0,0,a.audioparam.LINER),new a.Synth.Settings.EnvelopeSettings(0,0,1,a.audioparam.LINER,0,a.audioparam.LINER,0,0,a.audioparam.LINER,0,0,a.audioparam.LINER))},Object.defineProperty(this,"waveform",{configurable:!0,enumerable:!0,gat:function(){return this._waveform},set:function(a){this._wavefrom=a,this.onchange()}})},a.Synth.Settings.prototype.onchange=function(){},a.Synth.Settings.LFOSettings=function(a,b,c){this._waveform=a,this.frequency=b,this.amplitude=c,Object.defineProperty(this,"waveform",{configurable:!0,enumerable:!0,get:function(){return this._waveform},set:function(a){this._waveform=a,this.onchange()}})},a.Synth.Settings.LFOSettings.prototype.onchange=function(){},a.Synth.Settings.EnvelopeSettings=function(a,b,c,d,e,f,g,h,i,j,k,l){this._max=a,this._attackTime=b,this._attack=c,this._attackType=d,this._decayTime=e,this._decayType=f,this._sustainTime=g,this._sustain=h,this._sustainType=i,this._releaseTime=j,this._release=k,this._releaseType=l,Object.defineProperties(this,{max:{configurable:!0,enumerable:!0,get:function(){return this._max},set:function(a){this._max=a,this.onchange()}},attackTime:{configurable:!0,enumerable:!0,get:function(){return this._attackTime},set:function(a){this._attackTime=a,this.onchange()}},attack:{configurable:!0,enumerable:!0,get:function(){return this._attack},set:function(a){this._attack=a,this.onchange()}},attackType:{configurable:!0,enumerable:!0,get:function(){return this._attackType},set:function(a){this._attackType=a,this.onchange()}},decayTime:{configurable:!0,enumerable:!0,get:function(){return this._decayTime},set:function(a){this._decayTime=a,this.onchange()}},decayType:{configurable:!0,enumerable:!0,get:function(){return this._decayType},set:function(a){this._decayType=a,this.onchange()}},sustainTime:{configurable:!0,enumerable:!0,get:function(){return this._sustainTime},set:function(a){this._sustainTime=a,this.onchange()}},sustain:{configurable:!0,enumerable:!0,get:function(){return this._sustain},set:function(a){this._sustain=a,this.onchange()}},sustainType:{configurable:!0,enumerable:!0,get:function(){return this._sustainType},set:function(a){this._sustainType=a,this.onchange()}},releaseTime:{configurable:!0,enumerable:!0,get:function(){return this._releaseTime},set:function(a){this._releaseTime=a,this.onchange()}},release:{configurable:!0,enumerable:!0,get:function(){return this._release},set:function(a){this._release=a,this.onchange()}},releaseType:{configurable:!0,enumerable:!0,get:function(){return this._releaseType},set:function(a){this._releaseType=a,this.onchange()}}})},a.Synth.Settings.EnvelopeSettings.prototype.onchange=function(){},a});