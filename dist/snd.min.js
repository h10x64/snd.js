/* snd.js - The Sound Library for JavaScript with WebAudioAPI - v.0.1.0 */snd={VERSION:"62190",IS_BETA:!0},snd.BLOWSER=window.navigator.userAgent.toLowerCase(),snd.DOES_MP3_SUPPORTED=!1,-1!=snd.BLOWSER.indexOf("chrome")&&(snd.DOES_MP3_SUPPORTED=!0),snd.status={},snd.status.NONE="none",snd.status.READY="ready",snd.status.STARTED="started",snd.status.PAUSED="paused",snd.status.STOPPED="ended",snd.srctype={},snd.srctype.NONE="none",snd.srctype.AUDIO_BUFFER="AudioBuffer",snd.srctype.MEDIA_STREAM="MediaStream",snd.srctype.MEDIA_ELEMENT="MediaElement",snd.srctype.OSCILLATOR="Oscillator",snd.vec3=function(a,b,c){this.x=a,this.y=b,this.z=c},snd.vec3.prototype.add=function(a){return new snd.vec3(this.x+a.x,this.y+a.y,this.z+a.z)},snd.vec3.prototype.mult=function(a){return new snd.vec3(a*this.x,a*this.y,a*this.z)},snd.vec3.prototype.sub=function(a){return this.add(a.mult(-1))},snd.vec3.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},snd.vec3.prototype.normalize=function(){return this.mult(1/this.length())},snd.vec3.prototype.toSphericalCoordinate=function(){var a=Math.atan2(this.z,this.x),b=Math.atan2(this.y,Math.sqrt(this.z*this.z+this.x*this.x)),c=this.length();return new snd.vec3(a,b,c)},snd.vec3.prototype.toOrthogonalCoordinate=function(){var a=this.z*Math.sin(this.y),b=this.z*Math.cos(this.y)*Math.cos(this.x),c=this.z*Math.cos(this.y)*Math.sin(this.x);return new snd.vec3(b,a,c)},snd.PosDir=function(){this.pos=new snd.vec3(0,0,0),this.dir=new snd.vec3(0,0,-1),this.up=new snd.vec3(0,1,0)},snd.PosDir.prototype.setPosition=function(a,b,c){this.pos.x=a,this.pos.y=b,this.pos.z=c},snd.PosDir.prototype.setDir=function(a,b,c){this.dir.x=a,this.dir.y=b,this.dir.z=c,this.dir.normalize()},snd.PosDir.prototype.setUp=function(a,b,c){this.up.x=a,this.up.y=b,this.up.z=c,this.up.normalize()},snd.PosDir.prototype.setOrientation=function(a,b,c,d,e,f){this.setDir(a,b,c),this.setUp(d,e,f)},snd.PosDir.prototype.setOrientationBySpherical=function(a,b){var c;if(null!=b){var d=b.toOrthogonalCoordinate();this.setTop(d.x,d.y,d.z);var e=a.sub(b);e.normalize(),c=e.toOrthogonalCoordinate()}else c=a.toOrthogonalCoordinate();this.setDir(c.x,c.y,c.z)},snd.PosDir.interpolation=function(a,b,c){var d={},e={px:{left:a.pos.x,right:b.pos.x},py:{left:a.pos.y,right:b.pos.y},pz:{left:a.pos.z,right:b.pos.z},ux:{left:a.up.x,right:b.up.x},uy:{left:a.up.y,right:b.up.y},uz:{left:a.up.z,right:b.up.z},dx:{left:a.dir.x,right:b.dir.x},dy:{left:a.dir.y,right:b.dir.y},dz:{left:a.dir.z,right:b.dir.z}};for(var f in e)d[f]=e[f].left+(e[f].right-e[f].left)*c;var g=new snd.PosDir;return g.setPos(d.px,d.py,d.pz),g.setUp(d.ux,d.uy,d.uz),g.setDir(d.dx,d.dy,d.dz),g},snd.Source=function(a){this.isSource=!0,this.gain=snd.AUDIO_CONTEXT.createGain(),this.id=a,this.type=snd.srctype.NONE,this.status=snd.status.NONE,this.listeners={},this.sourceEventNames=[]},snd.Source.prototype.start=function(){},snd.Source.prototype.stop=function(){},snd.Source.prototype.connect=function(a){this.gain.connect(a.isAudioUnit?a.getConnector():a)},snd.Source.prototype.disconnect=function(a){this.gain.disconnect(a.isAudioUnit?a:a)},snd.Source.prototype.addEvent=function(a,b,c){var d=this;this[a]=function(){if(null!=c&&c(d),null!=d.listeners[b])for(var a=0;d.listeners[b].length;a++)d.listeners[b][a]["on"+b](d)},this.sourceEventNames.indexOf(a)&&this.sourceEventNames.push(a),this.listeners[b]=[],this["add"+b+"EventListener"]=function(a){d.listeners[b].push(a)},this["remove"+b+"EventListener"]=function(a){var c=d.listeners[b].indexOf(a);return 0>c?!1:void d.listeners[b].splice(c,1)}},snd.Source.prototype.setEventMethod=function(a){for(var b=0;b<this.sourceEventNames.length;b++)a[this.sourceEventNames[b]]=this[this.sourceEventNames[b]]},snd.Source.prototype.resetEventMethod=function(a){for(var b=0;b<this.sourceEventNames.length;b++)a[this.sourceEventNames[b]]=function(){}},snd.BufferSource=function(){snd.Source.apply(this,arguments),this.type=snd.srctype.AUDIO_BUFFER,this.status=snd.status.NONE,this.loop=!1,this.loopStart=null,this.loopEnd=null,this.addEvent("onended","Stop",function(a){a.status!=snd.status.STOPPED&&(a.status=snd.status.STOPPED)})},snd.BufferSource.prototype=Object.create(snd.Source.prototype),snd.BufferSource.prototype.constructor=snd.BufferSource,snd.BufferSource.prototype.start=function(a,b,c){null!=this.source&&this.status==snd.status.READY?(null==a?this.source.start(0):null==b?this.source.start(a):null==c?this.source.start(a,b):this.source.start(a,b,c),this.status=snd.status.STARTED):null!=this.audioBuffer&&(this.status==snd.status.STARTED?(this.stop(0),this.status=snd.status.STOPPED):this.setAudioBuffer(this.audioBuffer),this.start(a,b,c))},snd.BufferSource.prototype.stop=function(a){null!=this.source&&this.source.stop(null==a?0:a)},snd.BufferSource.prototype.connect=function(a){this.gain.connect(a.isAudioUnit?a.getConnector():a)},snd.BufferSource.prototype.disconnect=function(a){this.gain.disconnect(a)},snd.BufferSource.prototype.setAudioBuffer=function(a){this.audioBuffer=a;var b=snd.AUDIO_CONTEXT.createBufferSource();null!=this.source&&this.resetEventMethod(this.source),delete this.source,this.source=b,this.source.buffer=this.audioBuffer,this.source.connect(this.gain),this.setEventMethod(this.source),this.source.loop=this.loop,null!=this.loopStart&&(this.source.loopStart=this.loopStart),null!=this.loopEnd&&(this.source.loopEnd=this.loopEnd),this.status=snd.status.READY},snd.BufferSource.prototype.setLoop=function(a){null!=this.source&&(this.source.loop=a),this.loop=a},snd.BufferSource.prototype.setLoopStart=function(a){null!=this.source&&null!=a&&(this.source.loopStart=a),this.loopStart=a},snd.BufferSource.prototype.setLoopEnd=function(a){null!=this.source&&null!=a&&(this.source.loopEnd=a),this.loopEnd=a},snd.OscillatorSource=function(){snd.Source.apply(this,arguments),this.type=snd.srctype.OSCILLATOR,this.status=snd.status.NONE,this.addEvent("onended","Stop",function(){this.status=snd.status.STOPPED,this.resetOscillator()}),this.resetOscillator()},snd.OscillatorSource.prototype=Object.create(snd.Source.prototype),snd.OscillatorSource.prototype.constructor=snd.OscillatorSource,snd.OscillatorSource.DEFAULT_FREQUENCY=440,snd.OscillatorSource.prototype.setType=function(a){null!=this.source&&(this.source.type=a)},snd.OscillatorSource.prototype.getType=function(){return null!=this.source?this.source.type:null},snd.OscillatorSource.prototype.setFrequency=function(a){null!=this.source&&(this.source.frequency.value=a)},snd.OscillatorSource.prototype.getFrequency=function(){return null!=this.source?this.source.frequency.value:null},snd.OscillatorSource.prototype.setDetune=function(a){null!=this.source&&(this.source.detune.value=a)},snd.OscillatorSource.prototype.getDetune=function(){return null!=this.source?this.source.detune.value:null},snd.OscillatorSource.prototype.setPeriodicWave=function(a){null!=this.source&&this.source.setPeriodicWave(a)},snd.OscillatorSource.prototype.start=function(a){null!=this.source&&this.status!=snd.status.STARTED&&this.status!=snd.status.STOPPED&&this.source.start(null==a?0:a)},snd.OscillatorSource.prototype.stop=function(a){this.status!=snd.status.STOPPED&&this.source.stop(null==a?0:a)},snd.OscillatorSource.prototype.resetOscillator=function(){var a=null,b=null;null!=this.source&&(a=this.getFrequency(),b=this.getDetune(),this.status!=snd.status.STOPPED&&this.source.stop(0)),this.source=snd.AUDIO_CONTEXT.createOscillator(),this.source.connect(this.gain),this.setFrequency(null!=a?a:snd.OscillatorSource.DEFAULT_FREQUENCY),null!=b?this.setDetune(b):this.setFrequency(0),this.status=snd.status.READY},snd.MediaElementAudioSource=function(a,b){snd.Source.apply(this,arguments),this.source=snd.AUDIO_CONTEXT.createMediaElementSource(b),this.source.connect(this.gain),this.type=snd.srctype.MEDIA_ELEMENT,this.element=b,this.status=snd.status.NONE,this.addEvent("onplay","Start",function(a){a.status=snd.status.STARTED}),this.addEvent("pause","Pause",function(a){a.status=snd.status.PAUSED}),this.addEvent("onended","Stop",function(a){a.status=snd.status.STOPPED}),this.addEvent("onabort","Abort"),this.addEvent("oncanplay","CanPlay",function(a){a.status=snd.status.READY}),this.addEvent("oncanplaythrough","CanPlayThrough"),this.addEvent("ondurationchange","DurationChange"),this.addEvent("onemptied","Emptied"),this.addEvent("onerror","Error"),this.addEvent("onloadeddata","LoadedData"),this.addEvent("onloadedmetadata","LoadedMetaData"),this.addEvent("onloadstart","LoadStart"),this.addEvent("onplaying","Playing"),this.addEvent("onprogress","Progress"),this.addEvent("onratechange","RateChange"),this.addEvent("onseeked","Seeked"),this.addEvent("onseeking","Seeking"),this.addEvent("onstalled","Stalled"),this.addEvent("onsuspend","Suspend"),this.addEvent("ontimeupdate","TimeUpdate"),this.addEvent("onvalumechange","VolumeChange"),this.addEvent("onwaiting","Wating"),this.setEventMethod(this.source)},snd.MediaElementAudioSource.prototype=Object.create(snd.Source.prototype),snd.MediaElementAudioSource.prototype.constructor=snd.MediaElementAudioSource,snd.MediaElementAudioSource.prototype.load=function(){this.source.load()},snd.MediaElementAudioSource.prototype.start=function(){this.source.play()},snd.MediaElementAudioSource.prototype.pause=function(){this.source.pause()},snd.MediaElementAudioSource.prototype.stop=function(){this.source.stop()},snd.MediaStreamAudioSource=function(a,b){snd.Source.apply(this,arguments),this.source=snd.AUDIO_CONTEXT.createMediaStreamAudioSource(b),this.source.connect(this.gain),this.type=snd.srctype.MEDIA_STREAM},snd.MediaStreamAudioSource.prototype=Object.create(snd.Source.prototype),snd.MediaStreamAudioSource.prototype.constructor=snd.MediaStreamAudioSource,snd.AudioUnit=function(a){this.isAudioUnit=!0,this.id=a},snd.AudioUnit.prototype.connect=function(){},snd.AudioUnit.prototype.disconnect=function(){},snd.AudioUnit.prototype.getConnector=function(){},snd.GainOnlyUnit=function(){snd.AudioUnit.apply(this,arguments),this.gain=snd.AUDIO_CONTEXT.createGain()},snd.GainOnlyUnit.prototype=Object.create(snd.AudioUnit.prototype),snd.GainOnlyUnit.prototype.constructor=snd.GainOnlyUnit,snd.GainOnlyUnit.prototype.connect=function(a){snd.AudioUnit.connect.apply(this,a),this.gain.connect(a)},snd.GainOnlyUnit.prototype.getConnector=function(){return this.gain},snd.GainOnlyUnit.prototype.getGain=function(){return this.gain},snd.Listener=function(a){snd.PosDir.apply(this,arguments),this.listener=a,null!=a&&this.listener.setOrientation(this.dir.x,this.dir.y,this.dir.z,this.up.x,this.up.y,this.up.z)},snd.Listener.prototype=Object.create(snd.PosDir.prototype),snd.Listener.prototype.constructor=snd.Listener,snd.Listener.prototype.setListener=function(a){this.listener=a,this.setPosition(this.pos.x,this.pos.y,this.pos.z),this.setOrientation(this.dir.x,this.dir.y,this.dir.z,this.up.x,this.up.y,this.up.z)},snd.Listener.prototype.resetListener=function(){this.setListener(null)},snd.Listener.prototype.setPosition=function(a,b,c){snd.PosDir.prototype.setPosition.call(this,a,b,c),null!=this.listener&&this.listener.setPosition(snd.SOUND_ENVIRONMENT.unit*this.pos.x,snd.SOUND_ENVIRONMENT.unit*this.pos.y,snd.SOUND_ENVIRONMENT.unit*this.pos.z)},snd.Listener.prototype.setOrientation=function(a,b,c,d,e,f){snd.PosDir.prototype.setOrientation.call(this,a,b,c,d,e,f),null!=this.listener&&this.listener.setOrientation(this.dir.x,this.dir.y,this.dir.z,this.up.x,this.up.y,this.up.z)},snd.Listener.prototype.setOrientationBySpherical=function(a,b){snd.PosDir.prototype.setOrientationBySpherical.call(this,a,b),null!=this.listener&&this.listener.setOrientation(this.dir.x,this.dir.y,this.dir.z,this.up.x,this.up.y,this.up.z)},snd.Listener.prototype.setVelocity=function(a,b,c){null!=this.listener&&this.listener.setVelocity(snd.SOUND_ENVIRONMENT.unit*a,snd.SOUND_ENVIRONMENT.unit*b,snd.SOUND_ENVIRONMENT.unit*c)},snd.SoundNode=function(){snd.GainOnlyUnit.apply(this,arguments),snd.PosDir.apply(this,arguments),this.pannerNode=snd.AUDIO_CONTEXT.createPanner(),this.gain.connect(this.pannerNode)},snd.SoundNode.prototype=Object.create(snd.GainOnlyUnit.prototype),snd.SoundNode.prototype.constructor=snd.SoundNode,snd.SoundNode.prototype.connect=function(a){this.pannerNode.connect(a.isAudioUnit?a.getConnector():a)},snd.SoundNode.start=function(){},snd.SoundNode.stop=function(){},snd.SoundNode.pause=function(){},snd.SoundNode.prototype.setPosition=function(a,b,c){snd.PosDir.prototype.setPosition.call(this,a,b,c),this.pannerNode.setPosition(snd.SOUND_ENVIRONMENT.unit*this.pos.x,snd.SOUND_ENVIRONMENT.unit*this.pos.y,snd.SOUND_ENVIRONMENT.unit*this.pos.z)},snd.SoundNode.prototype.setDir=function(a,b,c){snd.PosDir.prototype.setDir.call(this,a,b,c),this.pannerNode.setOrientation(this.dir.x,this.dir.y,this.dir.z)},snd.SoundNode.prototype.setUp=function(a,b,c){snd.PosDir.prototype.setUp.call(this,a,b,c)},snd.SoundNode.prototype.setOrientation=function(a,b,c,d,e,f){snd.PosDir.prototype.setOrientation.call(this,a,b,c,d,e,f),this.pannerNode.setOrientation(this.dir.x,this.dir.y,this.dir.z)},snd.SoundNode.prototype.setVelocity=function(a,b,c){this.pannerNode.setVelocity(snd.SOUND_ENVIRONMENT.unit*a,snd.SOUND_ENVIRONMENT.unit*b,snd.SOUND_ENVIRONMENT.unit*c)},snd.AudioDataManager=function(){this.requests={},this.dataMap={},this.eventListeners={},this.allLoadEventListeners=[]},snd.AudioDataManager.prototype.onload=function(){for(var a=0;a<this.allLoadEventListeners.length;a++)this.allLoadEventListeners[a]()},snd.AudioDataManager.prototype.addAllDataLoadListener=function(a){this.allLoadEventListeners.push(a)},snd.AudioDataManager.prototype.removeAllDataLoadListener=function(a){for(var b=0;b<this.allLoadEventListeners.length;b++){var c=this.allLoadEventListeners[b];if(c===a)return delete this.allLoadEventListeners[b],!0}return!1},snd.AudioDataManager.prototype.addOnloadListener=function(a,b){null==this.eventListeners.onload[a]&&(this.eventListeners[a]=[]),this.eventListeners.onload[a].push(b)},snd.AudioDataManager.prototype.removeOnloadListener=function(a){return null!=this.eventListeners.onload[a]?(delete this.eventListeners.onload[a],!0):!1},snd.AudioDataManager.prototype.getAudioBuffer=function(a){return null!=this.dataMap[a]?this.dataMap[a].data:void 0},snd.AudioDataManager.prototype.add=function(a,b){var c=this;this.dataMap[a]={doesLoaded:!1};var d=new XMLHttpRequest;d.open("GET",b,!0),d.responseType="arraybuffer",d.onload=function(){snd.AUDIO_CONTEXT.decodeAudioData(d.response,function(b){c.dataMap[a].data=b,c.dataMap[a].doesLoaded=!0,c.loaded(a,b)})},this.requests[a]=d},snd.AudioDataManager.prototype.doesAllDataLoaded=function(){for(var a in this.dataMap)if(!this.dataMap[a].doesLoaded)return!1;return!0},snd.AudioDataManager.prototype.addAll=function(a){for(var b in a)this.add(b,a[b])},snd.AudioDataManager.prototype.load=function(a){if(null==a)for(var a in this.requests)this.requests[a].send();else this.requests[a].send()},snd.AudioDataManager.prototype.loaded=function(a,b){if(this.dataMap[a].doesLoaded=!0,null!=this.eventListeners[a])for(var c=0;c<this.eventListeners[a].onload.length;c++)this.eventListeners[a].onload[c](b);for(var d in this.dataMap)if(!this.dataMap[d].doesLoaded)return;this.onload()},snd.AudioMaster=function(){this.unitList={},this.gain=snd.AUDIO_CONTEXT.createGain(),this.gain.connect(snd.AUDIO_CONTEXT.destination)},snd.AudioMaster.prototype.connectAudioUnit=function(a,b){this.unitList[a]=b,b.connect(this.gain)},snd.AudioMaster.prototype.getAudioUnit=function(a){return this.unitList[a]},snd.AudioMaster.prototype.disconnectAudioUnit=function(a){var b=this.unitList[a];b.getConnector().disconnect(this.gain),delete this.unitList[a]},snd.SoundEnvironment=function(){this.now=0,this.listener=snd.AUDIO_CONTEXT.listener,this.listeners={},this.soundNodes={},this.unit=1},snd.SoundEnvironment.prefix={kilo:1e3,hecto:100,deca:10,metre:1,deci:.1,centi:.01,milli:.001},snd.SoundEnvironment.DEFAULT_BUFFER_MAX=1800,snd.SoundEnvironment.prototype.setUnitPrefix=function(a){this.unit=a},snd.SoundEnvironment.prototype.addListener=function(a,b){this.listeners[a]=new snd.PosDirTime(b,1)},snd.SoundEnvironment.prototype.removeListener=function(a){null!=this.soundNodes[a]&&delete this.soundNodes[a]},snd.SoundEnvironment.prototype.addSoundNode=function(a,b){this.soundNodes[a]=new snd.PosDirTime(b)},snd.SoundEnvironment.prototype.removeSoundNode=function(a){null!=this.soundNodes[a]&&delete this.soundNodes[a]},snd.SoundEnvironment.prototype.update=function(a){if(this.now>a)throw new snd.SoundEnvironment.UpdateError(this,"time < this.now (time: "+a+", this.now: "+this.now);for(var b in this.listeners)this.listeners[b].update(a);for(var b in this.soundNodes)this.soundNodes[b].update(a)},snd.SoundEnvironment.UpdateError=function(a,b){this._this=a,this.message=b},snd.PosDirTime=function(a,b){this.data=a,this.history=[],this.bufferMax=b},snd.PosDirTime.prototype.update=function(a){0==this.history.length&&this.history.push({time:0,posture:Object.create(this.data)}),this.history.length>this.bufferMax&&this.history.splice(0,1),this.history.push({time:a,posture:Object.create(this.data)})},snd.PosDirTime.prototype.getPosture=function(a){var b=this.search(a);if(null==b)return null;if(b.left==b.right)return this.history[b.left];var c=this.history[c],d=this.history[d],e=(a-c.time)/(d.time-c.time);return snd.PosDir.interpolation(c,d,e)},snd.PosDirTime.prototype.search=function(a){if(this.history.length<=0)return null;if(1==this.history.length)return{left:0,right:0};if(this.history[this.history.length-1].time<a)return{left:this.history.length-1,right:this.history.legnth-1};if(this.history[0].time>a)return{left:0,right:0};for(var b=0,c=this.history.length-1,d=Math.floor(c/2);;)if(d=Math.floor((a-this.history[b].time)*(c-b)/(this.history[c].time-this.history[b].time))+b,this.history[d].time<a){if(this.history[d+1]>a)return{left:d,right:d+1};b=d+1}else{if(!(this.history[d].time>a))return{left:d,right:d};if(this.history[d-1].time<a)return{left:d-1,right:d};c=d-1}},snd.util={},snd.util.createBufferSources=function(a,b){var c={},d={};for(var e in a){var f=a[e];null==c[f]&&(c[f]=[]);var g=new snd.BufferSource(e);c[f].push(g)}for(var f in c)d[f]=f;snd.AUDIO_DATA_MANAGER.addAll(d),snd.AUDIO_DATA_MANAGER.addAllDataLoadListener(function(){var a={};for(var d in c)for(var e=0;e<c[d].length;e++)c[d][e].setAudioBuffer(snd.AUDIO_DATA_MANAGER.getAudioBuffer(d)),a[c[d][e].id]=c[d][e];b(a)}),snd.AUDIO_DATA_MANAGER.load()},snd.util.noteToFrequency=function(a,b){return 440*Math.pow(2,(12*(a-4)+b)/12)},snd.util.noteToSec=function(a,b){return 60/(a*b/4)},snd.AUDIO_CONTEXT=null,snd.SOUND_ENVIRONMENT=null,snd.MASTER=null,snd.AUDIO_DATA_MANAGER=null,snd.LISTENER=null,snd.init=function(){snd.resetAudioContext(),snd.SOUND_ENVIRONMENT=new snd.SoundEnvironment,snd.MASTER=new snd.AudioMaster,snd.AUDIO_DATA_MANAGER=new snd.AudioDataManager},snd.resetAudioContext=function(){null==snd.AUDIO_CONTEXT&&("AudioContext"in window?snd.AUDIO_CONTEXT=new AudioContext:"webkitAudioContext"in window&&(snd.AUDIO_CONTEXT=new webkitAudioContext))};